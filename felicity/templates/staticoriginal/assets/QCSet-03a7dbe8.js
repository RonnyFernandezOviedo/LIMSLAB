import{d as pe,V as be,af as _e,r as y,t as Q,a as fe,o,c as l,b as e,n as j,u as d,G as p,e as F,F as g,y as v,x as c,f as x,ab as N,H as G,aa as H,I as ge,i as k,aX as xe}from"./index-60c5f486.js";import{u as me}from"./analysis-7c7b4512.js";import{h as w,o as R,a as C}from"./constants-6ee79ea2.js";const ve=e("hr",null,null,-1),ke={class:"flex justify-end"},we={key:0,class:"overflow-x-auto mt-4"},Re={class:"align-middle inline-block min-w-full shadow overflow-hidden bg-white shadow-dashboard px-2 pt-1 rounded-bl-lg rounded-br-lg"},Ce={class:"min-w-full"},Ue=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"},null,-1),Ee=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"}," Analysis ",-1),Se=e("th",{class:"px-1 py-1 border-b-2 border-gray-300"},null,-1),Ve={class:"bg-white"},Ae=e("td",{class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},null,-1),$e={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Te={class:"text-sm leading-5 text-gray-800"},De={class:"flex items-center"},Le=["onUpdate:modelValue","disabled"],qe={key:0,class:"text-sm leading-5 text-sky-800"},Ie={key:1,class:"block"},Pe=["onUpdate:modelValue","onKeyup"],Ke={key:2,class:"block col-span-2"},Ne=["onUpdate:modelValue","onChange"],ze=e("option",{value:""},null,-1),Be=["value"],Me={class:"text-sm italics text-sky-800"},Oe={key:1,class:"overflow-x-auto"},Qe={class:"align-middle inline-block min-w-full shadow overflow-hidden bg-white shadow-dashboard px-2 pt-1 rounded-bl-lg rounded-br-lg"},je={class:"min-w-full"},Fe={class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"},Ge=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"},null,-1),He=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"}," Analysis ",-1),We=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Methods ",-1),Xe=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Instrument ",-1),Je=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Analyst ",-1),Ye=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Result ",-1),Ze=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Re-Analizar ",-1),et=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Submitted ",-1),tt=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Due Date ",-1),st=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Status ",-1),at=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Reportable ",-1),nt=e("th",{class:"px-1 py-1 border-b-2 border-gray-300"},null,-1),ot={class:"bg-white"},lt=["onUpdate:modelValue","disabled"],rt=e("td",{class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},null,-1),it={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},dt={class:"text-sm leading-5 text-sky-800"},ct={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},ut={class:"text-sm leading-5 text-sky-800"},yt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},ht={class:"text-sm leading-5 text-sky-800"},pt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},bt={class:"text-sm leading-5 text-sky-800"},_t={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},ft={key:0,class:"text-sm leading-5 text-sky-800"},gt={key:1,class:"block"},xt=["onUpdate:modelValue","onKeyup"],mt={key:2,class:"block col-span-2 mb-2"},vt=["onUpdate:modelValue","onChange"],kt=e("option",{value:""},null,-1),wt=["value"],Rt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Ct={class:"text-sm leading-5 text-sky-800"},Ut={key:0,class:"text-sky-800"},Et=e("i",{class:"fa fa-check-circle","aria-hidden":"true"},null,-1),St=[Et],Vt={key:1,class:"text-orange-600"},At=e("i",{class:"fa fa-times-circle","aria-hidden":"true"},null,-1),$t=[At],Tt=e("td",{class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},[e("div",{class:"text-sm leading-5 text-sky-800"},"2020-10-10")],-1),Dt=e("td",{class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},[e("div",{class:"text-sm leading-5 text-sky-800"},"2020-10-10")],-1),Lt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},qt={type:"button",class:"bg-sky-800 text-white p-1rounded-smleading-none"},It={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Pt={class:"text-sm leading-5 text-sky-800"},Kt={key:0,class:"text-sky-800"},Nt=e("i",{class:"fa fa-thumbs-up","aria-hidden":"true"},null,-1),zt=[Nt],Bt={key:1,class:"text-orange-600"},Mt=e("i",{class:"fa fa-thumbs-down","aria-hidden":"true"},null,-1),Ot=[Mt],Qt=e("td",{class:"px-1 py-1 whitespace-no-wrap text-right border-b border-gray-500 text-sm leading-5"},null,-1),jt={class:"my-4"},Xt=pe({__name:"QCSet",setup(Ft){let b=be(),W=_e(),S=y(!1),A=y(!1),$=y(!1),T=y(!1),D=y(!1),_=y(!1);b.fetchQCSetByUid(W.params.qcSetUid);let f=Q(()=>{let a=b.getQCSet;if(!a)return;let t={levels:[],analytes:[]};return a?.samples?.forEach(r=>{r.assigned||(t.levels.some(s=>s.uid==r?.qcLevel?.uid)||t.levels.push(r?.qcLevel),r?.analysisResults?.forEach(s=>{t.analytes.some(i=>i.uid==s?.analysis?.uid)||t.analytes.push(s?.analysis);const n=t.analytes.findIndex(i=>i.uid==s?.analysis?.uid);t.analytes[n].items?t.analytes[n].items?.some(i=>i.sampleUid===s.sampleUid)||t.analytes[n].items.push({...s,sample:r}):t.analytes[n].items=[{...s,sample:r}]}))}),P("grid"),{levels:t.levels,analytes:t.analytes}});function z(){let a=[];return f?.value.analytes?.forEach(t=>t.items.forEach(r=>a.push(r))),a}function X(){let a=[];return f?.value.analytes?(f?.value.analytes?.forEach(t=>{t?.items?.forEach(r=>a.push(r))}),a):[]}function L(){let a=[];return f?.value.analytes?(f?.value.analytes?.forEach(t=>{t?.items?.forEach(r=>{r.checked&&a.push(r)})}),a):[]}function U(){const a=L();let t=[];return a?.forEach(r=>t.push(r.uid)),t}function u(){S.value=!1,A.value=!1,$.value=!1,T.value=!1,D.value=!1;const a=L();a.length!==0&&(a.every(t=>t.status==="cancelled")&&(D.value=!0),a.every(t=>t.status==="pending")&&(S.value=!0),a.every(t=>t.status==="resulted")&&(A.value=!0,$.value=!0,T.value=!0))}function J(){return X()?.every(t=>t.checked===!0)}function E(a){a.checked=!0,u()}function Y(a){a.checked=!1,u()}function Z(){z()?.forEach(t=>_.value?E(t):Y(t)),u()}function B(){J()?_.value=!0:_.value=!1,u()}function ee(a){a.editable=!0}function M(a){return a?.editable||xe(a?.result)?["cancelled","verified","retracted","to_be_verified"].includes(a.status)?(a.editable=!1,!1):(ee(a),!0):!1}function O(a){switch(a?.status){case"retracted":return!0;case"verified":return a?.reportable===!1;default:return!1}}function te(){let a=L(),t=[];return a?.forEach(r=>t.push({uid:r.uid,result:r.result})),t}const m=async()=>{const a=Q(()=>b.getSample);a.value&&b.fetchSampleStatus(a?.value?.uid)};let{submitResults:se,cancelResults:ae,reInstateResults:ne,approveResults:oe,retractResults:le,retestResults:re}=me();const ie=()=>se(te(),"qcset",b.qcSet?.uid).then(a=>(m(),u())),de=()=>ae(U()).then(a=>(m(),u())),ce=()=>ne(U()).then(a=>(m(),u())),ue=()=>oe(U(),"qcset",b.qcSet?.uid).then(a=>(m(),u())),ye=()=>le(U()).then(a=>(m(),u())),he=()=>re(U()).then(a=>(m(),u()));let h=y(!0),q=y("grid"),I=y(!1);function P(a){let t=[],r=[];b.getQCSet?.samples?.forEach(n=>{r.push(n),n.assigned||n?.analysisResults?.forEach(i=>t.push(i))});for(let n of r){const i=t.filter(K=>K.sampleUid===n.uid);let V=[];if(i?.forEach(K=>V.push(K.analysisUid)),I.value=new Set(V).size!==V.length,I.value===!0)break}I.value?(h.value=!1,q.value="list"):a==="grid"?(h.value=!0,q.value="grid"):(h.value=!1,q.value="list")}return(a,t)=>{const r=fe("font-awesome-icon");return o(),l(g,null,[ve,e("div",ke,[e("button",{class:j(["focus:outline-none",{"fill-current text-gray-900":d(h)===!0},{"fill-current text-gray-200":d(h)===!1}]),onClick:t[0]||(t[0]=p(s=>P("grid"),["prevent"]))},[F(r,{icon:"th"})],2),e("button",{class:j(["focus:outline-none ml-2",{"fill-current text-gray-900":d(h)===!1},{"fill-current text-gray-200":d(h)===!0}]),onClick:t[1]||(t[1]=p(s=>P("list"),["prevent"]))},[F(r,{icon:"th-list"})],2)]),d(h)?(o(),l("section",we,[e("div",Re,[e("table",Ce,[e("thead",null,[e("tr",null,[Ue,Ee,(o(!0),l(g,null,v(d(f)?.levels,s=>(o(),l("th",{key:s.uid,class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"},c(s?.level),1))),128)),Se])]),e("tbody",Ve,[(o(!0),l(g,null,v(d(f)?.analytes,s=>(o(),l("tr",{key:s.uid},[Ae,e("td",$e,[e("div",Te,c(s?.name),1)]),(o(!0),l(g,null,v(s?.items,n=>(o(),l("td",{key:n.uid,class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},[e("div",De,[x(e("input",{type:"checkbox",class:"mr-2","onUpdate:modelValue":i=>n.checked=i,onChange:t[2]||(t[2]=i=>B()),disabled:O(n)},null,40,Le),[[N,n.checked]]),e("div",null,[M(n)?n?.analysis?.resultOptions?.length<1?(o(),l("label",Ie,[x(e("input",{class:"form-input mt-1 block w-full","onUpdate:modelValue":i=>n.result=i,onKeyup:i=>E(n)},null,40,Pe),[[G,n.result]])])):(o(),l("label",Ke,[x(e("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":i=>n.result=i,onChange:i=>E(n)},[ze,(o(!0),l(g,null,v(n?.analysis?.resultOptions,(i,V)=>(o(),l("option",{key:i.optionKey,value:i.value},c(i.value),9,Be))),128))],40,Ne),[[H,n.result]])])):(o(),l("div",qe,c(n?.result),1)),e("div",Me,c(n?.status),1)])])]))),128))]))),128))])])])])):(o(),l("section",Oe,[e("div",Qe,[e("table",je,[e("thead",null,[e("tr",null,[e("th",Fe,[x(e("input",{type:"checkbox",class:"",onChange:t[3]||(t[3]=s=>Z()),"onUpdate:modelValue":t[4]||(t[4]=s=>ge(_)?_.value=s:_=s)},null,544),[[N,d(_)]])]),Ge,He,We,Xe,Je,Ye,Ze,et,tt,st,at,nt])]),e("tbody",ot,[(o(!0),l(g,null,v(z(),s=>(o(),l("tr",{key:s.uid},[e("td",null,[x(e("input",{type:"checkbox",class:"","onUpdate:modelValue":n=>s.checked=n,onChange:t[5]||(t[5]=n=>B()),disabled:O(s)},null,40,lt),[[N,s.checked]])]),rt,e("td",it,[e("div",dt,c(s.analysis?.name),1)]),e("td",ct,[e("div",ut,c(s.method?.name||"None"),1)]),e("td",yt,[e("div",ht,c(s.instrument?.name||"None"),1)]),e("td",pt,[e("div",bt,c(s.analyst?.name||"moyoza"),1)]),e("td",_t,[M(s)?s?.analysis?.resultOptions?.length===0?(o(),l("label",gt,[x(e("input",{class:"form-input mt-1 block w-full","onUpdate:modelValue":n=>s.result=n,onKeyup:n=>E(s)},null,40,xt),[[G,s.result]])])):(o(),l("label",mt,[x(e("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":n=>s.result=n,onChange:n=>E(s)},[kt,(o(!0),l(g,null,v(s?.analysis?.resultOptions,(n,i)=>(o(),l("option",{key:n.optionKey,value:n.value},c(n.value),9,wt))),128))],40,vt),[[H,s.result]])])):(o(),l("div",ft,c(s?.result),1))]),e("td",Rt,[e("div",Ct,[s?.retest?(o(),l("span",Ut,St)):(o(),l("span",Vt,$t))])]),Tt,Dt,e("td",Lt,[e("button",qt,c(s.status),1)]),e("td",It,[e("div",Pt,[s?.reportable?(o(),l("span",Kt,zt)):(o(),l("span",Bt,Ot))])]),Qt]))),128))])])])])),e("section",jt,[w(C.UPDATE,R.RESULT)&&d(S)?(o(),l("button",{key:0,onClick:t[6]||(t[6]=p(s=>de(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800rounded-smtransition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Cancel ")):k("",!0),w(C.UPDATE,R.RESULT)&&d(D)?(o(),l("button",{key:1,onClick:t[7]||(t[7]=p(s=>ce(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800rounded-smtransition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Re-Instate ")):k("",!0),w(C.UPDATE,R.RESULT)&&d(S)?(o(),l("button",{key:2,onClick:t[8]||(t[8]=p(s=>ie(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800rounded-smtransition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Submit ")):k("",!0),w(C.UPDATE,R.RESULT)&&d(A)?(o(),l("button",{key:3,onClick:t[9]||(t[9]=p(s=>ye(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800rounded-smtransition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Retract ")):k("",!0),w(C.UPDATE,R.RESULT)&&d($)?(o(),l("button",{key:4,onClick:t[10]||(t[10]=p(s=>ue(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800rounded-smtransition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Verificar ")):k("",!0),w(C.UPDATE,R.RESULT)&&d(T)?(o(),l("button",{key:5,onClick:t[11]||(t[11]=p(s=>he(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800rounded-smtransition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Re-Analizar ")):k("",!0)])],64)}}});export{Xt as default};
