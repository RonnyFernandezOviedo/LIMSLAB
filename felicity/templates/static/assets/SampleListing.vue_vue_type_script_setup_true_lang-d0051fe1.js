import{d as de,V as fe,a9 as pe,L as me,af as ve,E as ye,Q as A,t as P,r as R,ai as o,aj as B,aq as k,aH as he,o as be,c as ke,b as i,f as c,v as u,e as N,w as T,h as Ce,u as C,G as m,F as _e,z as Se,A as ge}from"./index-236e333a.js";import{u as xe}from"./samples-c52623f8.js";import{h as d,o as f,a as p}from"./constants-2df49315.js";const Ae={class:"mb-4 flex justify-start"},Re=i("hr",null,null,-1),Pe=de({__name:"SampleListing",setup(Ee){const I=Se(()=>ge(()=>import("./DataTable-9a1502f3.js"),["assets/DataTable-9a1502f3.js","assets/DataTable.vue_vue_type_script_setup_true_lang-559a40a5.js","assets/index-236e333a.js","assets/index-a964bbb1.css"])),v=fe(),E=pe(),{samplePageInfo:L,fetchingSamples:q}=me(v);let M=ve(),w=ye();const s=A({can_cancel:!1,can_receive:!1,can_reinstate:!1,can_reject:!1,can_copy_to:!1,can_download:!1,can_print:!1,can_publish:!1,can_store:!1,can_recover:!1}),b=P(()=>v.getSamples),D=R([{name:"Todas",value:""},{name:"Esperada",value:"esperada"},{name:"Recibida",value:"recibido"},{name:"Esperando",value:"Esperando"},{name:"Aprobada",value:"aprobada"},{name:"Publicada",value:"publicado"},{name:"Invalidada",value:"invalidada"},{name:"Cancelada",value:"cancelada"},{name:"Rechazada",value:"rechazada"},{name:"Almacenada",value:"stored"},{name:"Referred",value:"referred"},{name:"Paired",value:"paired"}]),H=R([{name:"UID",value:"uid",sortable:!0,sortBy:"asc",defaultSort:!0,showInToggler:!1,hidden:!0},{name:"",value:"",sortable:!1,showInToggler:!1,hidden:!1,customRender:function(e,a){return o("div",[e.priority>1?o("span",{class:[{"text-orange-600":e.priority>1}]},o("i",{class:"fa fa-star"})):"",e.status==="stored"?o("span",o("i",{class:"fa-briefcase"})):""])}},{name:"ID Muestra",value:"sampleId",sortable:!0,sortBy:"asc",hidden:!1,customRender:function(e,a){return o(B,{to:{name:"sample-detail",params:{patientUid:e?.analysisRequest?.patient?.uid,sampleUid:e?.uid}},innerHTML:e?.sampleId})}},{name:"Tipo Muestra",value:"sampleType.name",sortable:!1,sortBy:"asc",hidden:!0},{name:"Analisis",value:"",sortable:!1,sortBy:"asc",hidden:!1,customRender:function(e,a){return o("span",{innerHTML:j(e.profiles,e.analyses)},[])}},{name:"Contacto Cliente",value:"",sortable:!1,sortBy:"asc",hidden:!1,customRender:function(e,a){const t="analysisRequest.patient.firstName".split(".").reduce((r,x)=>r?.[x],e),n="analysisRequest.patient.lastName".split(".").reduce((r,x)=>r?.[x],e);return o("span",{innerHTML:`${t} ${n}`},[])}},{name:"Gender",value:"analysisRequest.patient.gender",sortable:!1,sortBy:"asc",hidden:!0},{name:"Age",value:"analysisRequest.patient.age",sortable:!1,sortBy:"asc",hidden:!0},{name:"ID Contacto Cliente",value:"analysisRequest.patient.clientPatientId",sortable:!1,sortBy:"asc",hidden:!1},{name:"Cliente",value:"analysisRequest.client.name",sortable:!1,sortBy:"asc",hidden:!1},{name:"Codigo Cliente",value:"analysisRequest.client.code",sortable:!1,sortBy:"asc",hidden:!0},{name:"Provincia",value:"analysisRequest.client.district.province.name",sortable:!1,sortBy:"asc",hidden:!0},{name:"Distrito",value:"analysisRequest.client.district.name",sortable:!1,sortBy:"asc",hidden:!0},{name:"ID Muestra Cliente",value:"analysisRequest.clientRequestId",sortable:!1,sortBy:"asc",hidden:!0},{name:"Date Collected",value:"dateCollected",sortable:!1,sortBy:"asc",hidden:!0,customRender:function(e,a){const t=a.value.split(".").reduce((n,r)=>n?.[r],e);return o("span",{innerHTML:k(t)},[])}},{name:"Fecha Creacion",value:"createdAt",sortable:!1,sortBy:"asc",hidden:!0,customRender:function(e,a){const t=a.value.split(".").reduce((n,r)=>n?.[r],e);return o("span",{innerHTML:k(t)},[])}},{name:"Creador",value:"createdBy.firstName",sortable:!1,sortBy:"asc",hidden:!1},{name:"Fecha received",value:"dateReceived",sortable:!1,sortBy:"asc",hidden:!0,customRender:function(e,a){const t=a.value.split(".").reduce((n,r)=>n?.[r],e);return o("span",{innerHTML:k(t)},[])}},{name:"Date Submitted",value:"dateSubmitted",sortable:!1,sortBy:"asc",hidden:!0,customRender:function(e,a){const t=a.value.split(".").reduce((n,r)=>n?.[r],e);return o("span",{innerHTML:k(t)},[])}},{name:"Fecha-Verificacion",value:"dateVerified",sortable:!1,sortBy:"asc",hidden:!0,customRender:function(e,a){const t=a.value.split(".").reduce((n,r)=>n?.[r],e);return o("span",{innerHTML:k(t)},[])}},{name:"Fecha-Publicacion",value:"datePublished",sortable:!1,sortBy:"asc",hidden:!0,customRender:function(e,a){const t=a.value.split(".").reduce((n,r)=>n?.[r],e);return o("span",{innerHTML:k(t)},[])}},{name:"Fecha-Impresion",value:"datePrinted",sortable:!1,sortBy:"asc",hidden:!0,customRender:function(e,a){const t=a.value.split(".").reduce((n,r)=>n?.[r],e);return o("span",{innerHTML:k(t)},[])}},{name:"Printed",value:"printed",sortable:!1,sortBy:"asc",hidden:!0},{name:"Estado",value:"status",sortable:!1,sortBy:"asc",hidden:!1,customRender:function(e,a){const t=a.value.split(".").reduce((n,r)=>n?.[r],e);return o("button",{type:"button",class:"bg-sky-800 text-white py-1 px-2 rounded-sm leading-none",innerHTML:t},[])}}]);M?.query?.clientUid&&v.resetSamples(),v.fetchSampleTypes();let $=A({first:void 0,after:"",text:"",sortBy:["name"]});E.fetchAnalysesServices($),E.fetchAnalysesProfiles();function j(e,a){let t=[];return e.forEach(n=>t.push(n.name)),a.forEach(n=>t.push(n.name)),t.join(", ")}let l=A({first:50,before:"",status:"",text:"",sortBy:["-uid"],clientUid:he(M?.query?.clientUid),filterAction:!1});v.fetchSamples(l);function F(e){l.first=e.fetchCount,l.before=L?.value?.endCursor??"",l.text=e.filterText,l.status=e.filterStatus,l.filterAction=!1,v.fetchSamples(l)}function O(e){l.first=50,l.before="",l.text=e.filterText,l.status=e.filterStatus,l.filterAction=!0,v.fetchSamples(l)}const _=R(!1);function U(e){b.value?.forEach(a=>a.checked=e.checked),_.value=e.checked,g()}function V(e){const a=b.value.findIndex(t=>t.uid===e.uid);b.value[a].checked=e.checked,z()?_.value=!0:_.value=!1,g()}async function y(){b.value?.forEach(e=>e.checked=!1),_.value=!1,g()}function z(){return b.value?.every(e=>e.checked===!0)}function S(){let e=[];return b.value?.forEach(a=>{a.checked&&e.push(a)}),e}function g(){s.can_cancel=!1,s.can_receive=!1,s.can_reinstate=!1,s.can_download=!1,s.can_publish=!1,s.can_print=!1,s.can_reject=!1,s.can_store=!1,s.can_recover=!1,s.can_copy_to=!1;const e=S();e.length!==0&&(e.every(a=>a.status==="esperada")&&(s.can_receive=!0),e.every(a=>["recibido","esperada"].includes(a.status))&&(s.can_cancel=!0,s.can_reject=!0),e.every(a=>["recibido"].includes(a.status))&&(s.can_store=!0,s.can_copy_to=!0),e.every(a=>["stored"].includes(a.status))&&(s.can_recover=!0),e.every(a=>a.status==="cancelada")&&(s.can_reinstate=!0),e.every(a=>["aprobada","publicado"].includes(a.status))&&(s.can_copy_to=!0),e.every(a=>a.status==="aprobada")&&(s.can_publish=!0),e.every(a=>a.status==="publicado")&&(s.can_print=!0,s.can_download=!0))}function h(){const e=S();let a=[];return e?.forEach(t=>a.push(t.uid)),a}const{cancelSamples:G,reInstateSamples:J,receiveSamples:Q,printSamples:Z,downloadSamplesImpress:K,publishSamples:W,recoverSamples:X,cloneSamples:Y}=xe(),ee=P(()=>v.getSamples?.length+" de "+v.getSampleCount+" samples"),ae=async()=>Y(h()).finally(()=>y()),te=async()=>G(h()).finally(()=>y()),se=async()=>J(h()).finally(()=>y()),ne=async()=>Q(h()).finally(()=>y()),re=async()=>{const e=h().map(a=>({uid:a,action:"publicado"}));await W(e).finally(()=>y())},oe=async()=>await Z(h()).finally(()=>y()),le=async()=>await K(h()).finally(()=>y()),ie=async()=>{const e=S();w.push({name:"reject-samples",state:{samples:JSON.stringify(e)}})},ce=async()=>{const e=S();w.push({name:"store-samples",state:{samples:JSON.stringify(e)}})},ue=async()=>X(h()).finally(()=>y());return(e,a)=>(be(),ke(_e,null,[i("div",Ae,[c(N(C(B),{to:"/patients/search",class:"px-2 py-1 border-sky-800 border text-sky-800rounded-smtransition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"},{default:T(()=>[Ce("Agregar Solicitud de Laboratorio ")]),_:1},512),[[u,d(p.CREATE,f.SAMPLE)]])]),Re,N(C(I),{columns:H.value,data:b.value,toggleColumns:!0,loading:C(q),paginable:!0,pageMeta:{fetchCount:C(l).first,hasNextPage:C(L)?.hasNextPage,countNone:ee.value},searchable:!0,filterable:!0,filterMeta:{defaultFilter:C(l).status,filters:D.value},selectable:!0,allChecked:_.value,onOnSearch:O,onOnPaginate:F,onOnCheck:V,onOnCheckAll:U},{footer:T(()=>[i("div",null,[c(i("button",{onClick:a[0]||(a[0]=m(t=>te(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800rounded-smtransition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Cancelar ",512),[[u,d(p.CANCEL,f.SAMPLE)&&s.can_cancel]]),c(i("button",{onClick:a[1]||(a[1]=m(t=>se(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800rounded-smtransition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," ReInstate ",512),[[u,d(p.CANCEL,f.SAMPLE)&&s.can_reinstate]]),c(i("button",{onClick:a[2]||(a[2]=m(t=>ne(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800rounded-smtransition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Recibir ",512),[[u,d(p.CANCEL,f.SAMPLE)&&s.can_receive]]),c(i("button",{onClick:a[3]||(a[3]=m(t=>ce(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800rounded-smtransition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Almacenar ",512),[[u,d(p.CANCEL,f.SAMPLE)&&s.can_store]]),c(i("button",{onClick:a[4]||(a[4]=m(t=>ue(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800rounded-smtransition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Recuperar ",512),[[u,d(p.CANCEL,f.SAMPLE)&&s.can_recover]]),c(i("button",{onClick:a[5]||(a[5]=m(t=>ie(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800rounded-smtransition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Rechazar ",512),[[u,d(p.CANCEL,f.SAMPLE)&&s.can_reject]]),c(i("button",{onClick:a[6]||(a[6]=m(t=>ae(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800rounded-smtransition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Copy to New ",512),[[u,d(p.CANCEL,f.SAMPLE)&&s.can_copy_to]]),c(i("button",{onClick:a[7]||(a[7]=m(t=>le(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800rounded-smtransition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Descargar ",512),[[u,d(p.CANCEL,f.SAMPLE)&&s.can_download]]),c(i("button",{onClick:a[8]||(a[8]=m(t=>re(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800rounded-smtransition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Publish ",512),[[u,d(p.CANCEL,f.SAMPLE)&&s.can_publish]]),c(i("button",{onClick:a[9]||(a[9]=m(t=>oe(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800rounded-smtransition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Imprimir ",512),[[u,d(p.CANCEL,f.SAMPLE)&&s.can_print]])])]),_:1},8,["columns","data","loading","pageMeta","filterMeta","allChecked"])],64))}});export{Pe as _};
