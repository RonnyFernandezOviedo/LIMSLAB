import{U as F,bU as fe,B as ge,d as ve,a8 as ke,S as xe,aI as we,af as Ue,r as u,t as Re,Q as Ce,a as Se,M as L,o as n,c as a,f as r,b as e,h as M,I as G,ab as O,u as d,F as f,y as g,x as i,aa as x,e as Ee,w as Q,G as y,v as b,n as X,i as J,N as Ae,H as Te,z as Ve,A as De,aX as We}from"./index-7fd050f3.js";import{u as Ne}from"./analysis-937e6e00.js";import{h as w,o as U,a as R}from"./constants-df8aad36.js";function Be(){const{withClientMutation:$}=ge();return{unAssignSamples:async v=>{try{F.fire({title:"Esta seguro?",text:"Usted quiere Desasignar estos analsis",icon:"warning",showCancelButton:!0,confirmButtonColor:"#3085d6",cancelButtonColor:"#d33",confirmButtonText:"Si, Desasignar ahora!",cancelButtonText:"No, cancelar Desasignar!"}).then(async c=>{c.isConfirmed&&(await $(fe,v,"updateWorksheet").then(C=>{}),F.fire("ok!","Analisis selecionados han sido desasignados.","success").then(C=>location.reload()))})}catch{}}}}const Ie={class:""},Me=e("hr",{class:"mt-4"},null,-1),Oe={class:"flex justify-between items-center"},$e={for:"toggle",class:"text-medium text-gray-700 my-4"},Ke={class:"relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in"},Pe=e("label",{for:"toggle",class:"toggle-label block overflow-hidden h-6 rounded-full bg-gray-300 cursor-pointer"},null,-1),qe={action:"post",class:"p-1"},He={class:"flex justify-start items-center mb-4"},je={class:"flex justify-between items-center"},ze=e("span",{class:"text-gray-700 mr-2"},"Analyst",-1),Fe=["value"],Le={class:"flex justify-between items-center ml-4"},Ge=e("span",{class:"text-gray-700 mr-2"},"Instrument",-1),Qe=["value"],Xe={class:"flex justify-between items-center ml-4"},Je=e("span",{class:"text-gray-700 mr-2"},"Method",-1),Ye=["value"],Ze={class:"ml-6 mt-2"},et=e("hr",{class:"mb-4"},null,-1),tt={class:"overflow-x-auto"},st={class:"align-middle inline-block min-w-full shadow overflow-hidden bg-white shadow-dashboard px-2 pt-1 rounded-bl-lg rounded-br-lg"},ot={class:"min-w-full"},nt={class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"},at=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"},null,-1),lt=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left leading-4 text-gray-800 tracking-wider"}," Sample ID ",-1),rt=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Analysis/Test ",-1),it=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Instrument ",-1),dt=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Method ",-1),ut=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Interim ",-1),ct=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Result ",-1),pt=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Unit ",-1),ht=e("th",{class:"px-1 py-1 border-b-2 border-gray-300 text-left text-sm leading-4 text-gray-800 tracking-wider"}," Status ",-1),mt={class:"bg-white"},yt=["onUpdate:modelValue","disabled"],bt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},_t=e("i",{class:"fa fa-star"},null,-1),ft=[_t],gt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},vt={class:"text-sm leading-5 text-gray-800 font-semibold"},kt={key:1},xt={key:0},wt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Ut={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Rt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Ct={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},St={key:0,class:"text-sm leading-5 text-sky-800"},Et={key:1,class:"block col-span-2 mb-2"},At=["onUpdate:modelValue","onChange"],Tt=e("option",{value:""},null,-1),Vt=["value"],Dt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Wt={key:0},Nt={key:1,class:"block"},Bt=["onUpdate:modelValue","onKeyup"],It={key:2,class:"block col-span-2 mb-2"},Mt=["onUpdate:modelValue","onChange"],Ot=e("option",{value:""},null,-1),$t=["value"],Kt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},Pt={class:"px-1 py-1 whitespace-no-wrap border-b border-gray-500"},qt={type:"button",class:"bg-sky-800 text-white py-1 px-2 rounded-sm leading-none"},Ht={class:"my-4"},Lt=ve({__name:"WorkSheetResults",setup($){const K=Ve(()=>De(()=>import("./Button-a1d85628.js"),["assets/Button-a1d85628.js","assets/index-7fd050f3.js","assets/index-a964bbb1.css"])),v=ke(),c=xe(),C=we(),P=Ue();let V=u(!1),D=u(!1),W=u(!1),N=u(!1),B=u(!1),p=u(!1),k=u(!1),h=Re(()=>v.getWorkSheet);const q=()=>{v.fetchWorksheetByUid(P.params.workSheetUid)};C.fetchUsers({}),c.fetchInstruments(),c.fetchMethods();const m=Ce({analystUid:void 0,instrumentUid:void 0,methodUid:void 0}),S=u(!1),Y=()=>{S.value=!0,v.updateWorksheet({worksheetUid:P.params.workSheetUid,...m}).then(()=>{S.value=!1,q()})};function Z(){return h.value?.analysisResults?.every(o=>o.checked===!0)}function I(){let o=[];return h.value?.analysisResults?.forEach(s=>{s.checked&&o.push(s)}),o}function ee(){Z()?p.value=!0:p.value=!1,T()}function E(o){if(H(o)){j(o);return}o.checked=!0,T()}function H(o){return["retracted","aprobada"].includes(o.status)}function j(o){o.checked=!1,T()}function te(){h?.value?.analysisResults?.forEach(o=>p.value?E(o):j(o)),T()}function se(o){o.editable=!0}function z(o){return o.status!=="pendiente"?!1:o?.editable||We(o?.result)?(se(o),!0):!1}function oe(){let o=I(),s=[];return o?.forEach(_=>s.push({uid:_.uid,result:_.result})),s}function A(){const o=I();let s=[];return o?.forEach(_=>s.push(_.uid)),s}function ne(o){switch(o?.status){case"retracted":return"bg-gray-300 text-sm italic text-gray-500";case"pendiente":return o?.retest===!0?"bg-sky-800 text-sm leading-5 text-sky-800":"";case"resultado":return o?.retest===!0?"bg-sky-800 text-sm leading-5 text-sky-800":"";case"aprobada":return o?.retest===!0?"bg-sky-800 text-sm leading-5 text-sky-800":"";default:return"text-sm leading-5 text-sky-800"}}function T(){V.value=!1,B.value=!1,D.value=!1,W.value=!1,N.value=!1;const o=I();o.length!==0&&(o.every(s=>s.status==="pendiente")&&(V.value=!0,B.value=!0),o.every(s=>s.status==="reportado")&&(D.value=!0,W.value=!0,N.value=!0))}const{submitResults:ae,approveResults:le,retractResults:re,retestResults:ie}=Ne(),{unAssignSamples:de}=Be(),ue=()=>de(A()),ce=()=>ae(oe(),"worksheet",h.value?.uid),pe=()=>le(A(),"worksheet",h.value?.uid),he=()=>re(A()),me=()=>ie(A());return(o,s)=>{const _=Se("router-link"),ye=L("motion-slide-left"),be=L("motion-slide-right");return n(),a("div",Ie,[Me,r((n(),a("div",Oe,[e("label",$e,[M("More Sample Detail "),e("div",Ke,[r(e("input",{type:"checkbox",name:"toggle",id:"toggle","onUpdate:modelValue":s[0]||(s[0]=t=>G(k)?k.value=t:k=t),class:"toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer outline-none"},null,512),[[O,d(k)]]),Pe])]),r(e("form",qe,[e("div",He,[e("label",je,[ze,r(e("select",{name:"instrument_uid","onUpdate:modelValue":s[1]||(s[1]=t=>m.analystUid=t),class:"form-input mt-1 block w-full py-1"},[(n(!0),a(f,null,g(d(C).users,t=>(n(),a("option",{key:t.uid,value:t.uid},i(t.firstName)+" "+i(t.lastName),9,Fe))),128))],512),[[x,m.analystUid]])]),e("label",Le,[Ge,r(e("select",{name:"instrument_uid","onUpdate:modelValue":s[2]||(s[2]=t=>m.instrumentUid=t),class:"form-input mt-1 block w-full py-1"},[(n(!0),a(f,null,g(d(c).instruments,t=>(n(),a("option",{key:t.uid,value:t.uid},i(t.name),9,Qe))),128))],512),[[x,m.instrumentUid]])]),e("label",Xe,[Je,r(e("select",{name:"method_uid","onUpdate:modelValue":s[3]||(s[3]=t=>m.methodUid=t),class:"form-input mt-1 block w-full py-1"},[(n(!0),a(f,null,g(d(c).methods,t=>(n(),a("option",{key:t.uid,value:t.uid},i(t.name),9,Ye))),128))],512),[[x,m.methodUid]])]),e("div",Ze,[Ee(d(K),{onClick:s[4]||(s[4]=y(t=>Y(),["prevent"])),color:"sky-800",class:"p-1"},{default:Q(()=>[M("Apply")]),_:1})])])],512),[[b,!S.value]]),r(e("p",null,"updating ...",512),[[b,S.value]]),e("div",null,[e("button",{onClick:s[5]||(s[5]=y(t=>q(),["prevent"])),class:"px-1 py-1 mr-2 border-sky-800 border text-sky-800rounded-smtransition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Refresh ")])])),[[ye]]),et,e("div",tt,[e("div",st,[e("table",ot,[e("thead",null,[e("tr",null,[e("th",nt,[r(e("input",{type:"checkbox",class:"",onChange:s[6]||(s[6]=t=>te()),"onUpdate:modelValue":s[7]||(s[7]=t=>G(p)?p.value=t:p=t)},null,544),[[O,d(p)]])]),at,lt,rt,it,dt,ut,ct,pt,ht])]),e("tbody",mt,[(n(!0),a(f,null,g(d(h)?.analysisResults,t=>r((n(),a("tr",{key:t.uid,class:X([ne(t)])},[e("td",null,[r(e("input",{type:"checkbox",class:"","onUpdate:modelValue":l=>t.checked=l,onChange:s[8]||(s[8]=l=>ee()),disabled:H(t)},null,40,yt),[[O,t.checked]])]),e("td",bt,[t?.sample?.priority>0?(n(),a("span",{key:0,class:X(["font-small",{"text-orange-600":d(h)?.priority>1}])},ft,2)):J("",!0)]),e("td",gt,[e("div",vt,[t?.sample?.analysisRequest?.patient?.uid?(n(),Ae(_,{key:0,to:{name:"sample-detail",params:{patientUid:t?.sample?.analysisRequest?.patient?.uid,sampleUid:t?.sample?.uid}}},{default:Q(()=>[M(i(t?.sample?.sampleId),1)]),_:2},1032,["to"])):(n(),a("div",kt,i(t?.sample?.sampleId),1))]),d(k)?(n(),a("span",xt,[e("span",null,i(t?.sample?.qcLevel?.level),1),e("div",null,i(t?.sample?.analysisRequest?.patient?.firstName)+" "+i(t?.sample?.analysisRequest?.patient?.lastName),1),e("div",null,i(t?.sample?.analysisRequest?.client?.name),1)])):J("",!0)]),e("td",wt,[e("div",null,i(t?.analysis?.name),1)]),e("td",Ut,[e("div",null,i(t?.instrument?.name||"None"),1)]),e("td",Rt,[e("div",null,i(t?.method?.name||"None"),1)]),e("td",Ct,[!z(t)||(t?.analysis?.interims?.length??0)===0?(n(),a("div",St," --- ")):(n(),a("label",Et,[r(e("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":l=>t.result=l,onChange:l=>E(t)},[Tt,(n(!0),a(f,null,g(t?.analysis?.interims,(l,_e)=>(n(),a("option",{key:l.key,value:l.value},i(l.value),9,Vt))),128))],40,At),[[x,t.result]])]))]),e("td",Dt,[z(t)?t?.analysis?.resultOptions?.length===0?(n(),a("label",Nt,[r(e("input",{class:"form-input mt-1 block w-full","onUpdate:modelValue":l=>t.result=l,onKeyup:l=>E(t)},null,40,Bt),[[Te,t.result]])])):(n(),a("label",It,[r(e("select",{class:"form-input mt-1 block w-full","onUpdate:modelValue":l=>t.result=l,onChange:l=>E(t)},[Ot,(n(!0),a(f,null,g(t?.analysis?.resultOptions,(l,_e)=>(n(),a("option",{key:l.optionKey,value:l.value},i(l.value),9,$t))),128))],40,Mt),[[x,t.result]])])):(n(),a("div",Wt,i(t?.result),1))]),e("td",Kt,[e("div",null,i(t?.analysis?.unit?.name||"---"),1)]),e("td",Pt,[e("button",qt,i(t?.status||"unknown"),1)])],2)),[[be]])),128))])])])]),e("section",Ht,[r(e("button",{onClick:s[9]||(s[9]=y(t=>ue(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800rounded-smtransition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Un Assign ",512),[[b,w(R.CREATE,U.WORKSHEET)&&d(B)]]),r(e("button",{onClick:s[10]||(s[10]=y(t=>ce(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800rounded-smtransition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Submit ",512),[[b,w(R.UPDATE,U.WORKSHEET)&&d(V)]]),r(e("button",{onClick:s[11]||(s[11]=y(t=>he(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800rounded-smtransition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Retract ",512),[[b,w(R.UPDATE,U.WORKSHEET)&&d(D)]]),r(e("button",{onClick:s[12]||(s[12]=y(t=>pe(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800rounded-smtransition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Aprobar ",512),[[b,w(R.UPDATE,U.WORKSHEET)&&d(W)]]),r(e("button",{onClick:s[13]||(s[13]=y(t=>me(),["prevent"])),class:"px-2 py-1 mr-2 border-sky-800 border text-sky-800rounded-smtransition duration-300 hover:bg-sky-800 hover:text-white focus:outline-none"}," Re-Analizar ",512),[[b,w(R.UPDATE,U.WORKSHEET)&&d(N)]])])])}}});export{Lt as default};
